{"code":"import { isFunction } from \"@vue/shared\";\r\nimport { createDep, isTracking, ReactiveEffect, trackEffects, triggerEffects } from './effect';\r\nclass ComputedRefImpl {\r\n    constructor(getter, _setter) {\r\n        this._setter = _setter;\r\n        this.dep = createDep();\r\n        this._dirty = true;\r\n        this.__v_isRef = true;\r\n        this.effect = new ReactiveEffect(getter, () => {\r\n            if (this._dirty)\r\n                return;\r\n            this._dirty = true;\r\n            triggerEffects(this.dep);\r\n        });\r\n    }\r\n    get value() {\r\n        //收集依赖\r\n        if (isTracking()) { //判断是否需要搜集依赖\r\n            trackEffects(this.dep);\r\n        }\r\n        if (this._dirty) {\r\n            this._dirty = false;\r\n            this._value = this.effect.run();\r\n        }\r\n        return this._value;\r\n    }\r\n    set value(newValue) {\r\n        this._setter(newValue);\r\n    }\r\n}\r\nexport function computed(getterOrOptions) {\r\n    let getter;\r\n    let setter;\r\n    const onlyGetter = isFunction(getterOrOptions);\r\n    if (onlyGetter) {\r\n        getter = getterOrOptions;\r\n    }\r\n    else {\r\n        getter = getterOrOptions.get;\r\n        setter = getterOrOptions.set;\r\n    }\r\n    const cRef = new ComputedRefImpl(getter, setter);\r\n    return cRef;\r\n}\r\n//# sourceMappingURL=computed.js.map","references":["D:/code/mini-vue3/packages/shared/src/index.ts","D:/code/mini-vue3/packages/reactivity/src/effect.ts"],"map":"{\"version\":3,\"file\":\"computed.js\",\"sourceRoot\":\"\",\"sources\":[\"../../../../../../packages/reactivity/src/computed.ts\"],\"names\":[],\"mappings\":\"AAAA,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAC;AACzC,OAAO,EAAE,SAAS,EAAE,UAAU,EAAE,cAAc,EAAE,YAAY,EAAE,cAAc,EAAE,MAAM,UAAU,CAAA;AAE9F,MAAM,eAAe;IAMnB,YAAY,MAAgB,EAAS,OAAiB;QAAjB,YAAO,GAAP,OAAO,CAAU;QAL/C,QAAG,GAAa,SAAS,EAAE,CAAC;QAC5B,WAAM,GAAY,IAAI,CAAA;QACtB,cAAS,GAAY,IAAI,CAAA;QAI9B,IAAI,CAAC,MAAM,GAAG,IAAI,cAAc,CAAC,MAAM,EAAE,GAAG,EAAE;YAC5C,IAAI,IAAI,CAAC,MAAM;gBAAE,OAAM;YACvB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAA;YAClB,cAAc,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;QAC1B,CAAC,CAAC,CAAA;IACJ,CAAC;IACD,IAAI,KAAK;QACP,MAAM;QACN,IAAI,UAAU,EAAE,EAAE,EAAE,YAAY;YAC9B,YAAY,CAAC,IAAI,CAAC,GAAG,CAAC,CAAA;SACvB;QACD,IAAI,IAAI,CAAC,MAAM,EAAE;YACf,IAAI,CAAC,MAAM,GAAG,KAAK,CAAA;YACnB,IAAI,CAAC,MAAM,GAAG,IAAI,CAAC,MAAM,CAAC,GAAG,EAAE,CAAA;SAChC;QACD,OAAO,IAAI,CAAC,MAAM,CAAA;IACpB,CAAC;IACD,IAAI,KAAK,CAAC,QAAQ;QAChB,IAAI,CAAC,OAAO,CAAC,QAAQ,CAAC,CAAA;IACxB,CAAC;CACF;AAED,MAAM,UAAU,QAAQ,CAAC,eAAoB;IAC3C,IAAI,MAAM,CAAC;IACX,IAAI,MAAM,CAAC;IACX,MAAM,UAAU,GAAG,UAAU,CAAC,eAAe,CAAC,CAAA;IAC9C,IAAI,UAAU,EAAE;QACd,MAAM,GAAG,eAAe,CAAA;KACzB;SAAM;QACL,MAAM,GAAG,eAAe,CAAC,GAAG,CAAA;QAC5B,MAAM,GAAG,eAAe,CAAC,GAAG,CAAA;KAC7B;IACD,MAAM,IAAI,GAAG,IAAI,eAAe,CAAC,MAAM,EAAE,MAAM,CAAC,CAAA;IAChD,OAAO,IAAI,CAAA;AACb,CAAC\"}"}
